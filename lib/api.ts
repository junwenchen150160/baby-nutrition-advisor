import { BabyData, RecommendationType } from './types';

// 本地生成建议的函数（用于静态导出）
function generateRecommendationsByAge(age: number): RecommendationType {
  if (age < 6) {
    return {
      food: `1. 科学辅食推荐

#主食推荐
宝宝处于辅食初期阶段，建议从单一食材泥开始，如米糊、苹果泥、胡萝卜泥等。每次尝试一种新食物，间隔3-5天，观察是否有过敏反应。

#营养搭配
这个阶段母乳或配方奶仍是主要营养来源，辅食只是补充。从蔬菜泥和水果泥开始，逐渐引入谷物泥。铁含量丰富的食物很重要，如强化米粉。

#中医调理建议
根据中医理念，4-6个月宝宝脾胃功能尚未完全发育，应选择温热性食物，如熟红薯泥、小米粥等，避免生冷食物。`,
      activity: `2. 亲子互动建议

#语言启蒙
与宝宝面对面说话，重复简单的词语如"妈妈"、"爸爸"、"宝宝"等。用夸张的表情和音调吸引宝宝注意，有助于语言理解和模仿能力发展。

#情感互动
每天安排10-15分钟的专注互动时间，如对视、微笑、轻柔抚触等。这个阶段的肢体接触对建立安全感和情感联结至关重要。

#日常游戏
尝试简单的躲猫猫游戏，用小毛巾遮住自己的脸再露出来，说"peek-a-boo"。宝宝会因为你的"消失"和"出现"而开心地笑。`,
      development: `3. 智力开发建议

#感官刺激
提供不同质地的玩具，如软的、硬的、粗糙的、光滑的，帮助宝宝发展触觉。彩色对比鲜明的玩具有助于视觉发展。

#认知训练
在宝宝面前演示物体的隐藏和出现，培养物体永久性概念。例如，将玩具藏在毯子下，鼓励宝宝寻找。

#专注力培养
选择有声音的玩具，如摇铃，引导宝宝追踪声源，培养注意力和听觉分辨能力。每次训练不要超过5分钟，避免宝宝疲劳。`,
      exercise: `4. 运动建议

#头部控制
适当的俯卧时间（趣趣时间）对宝宝颈部肌肉发展很重要。每天累计安排20-30分钟，可分3-4次进行，每次5-10分钟。

#翻身训练
当宝宝仰卧时，轻轻抬起一侧的臀部和腿，引导宝宝向另一侧翻身。随着宝宝力量增强，逐渐减少辅助。

#抓握练习
将小玩具放在宝宝手边，鼓励其伸手抓取。这有助于手眼协调能力和精细运动技能的发展。确保玩具足够大，防止误吞。`
    };
  } else if (age < 12) {
    return {
      food: `1. 科学辅食推荐

#主食推荐
6-12个月宝宝可以尝试更多种类的食物和质地。主食可选择软煮的碎米饭、小米粥、面条碎等。蛋黄可以少量添加，从1/4个开始，观察接受情况。

#蛋白质来源
这个阶段可以添加鱼泥、豆腐泥、碎肉末等优质蛋白。鱼类选择刺少的品种如三文鱼、鳕鱼；肉类选择瘦肉，煮熟后剁碎或绞成末。

#蔬果选择
富含维生素的蔬菜如西兰花、胡萝卜、南瓜等应每日提供。水果可选择香蕉、苹果、梨等制成泥状或小块。注意控制水果量，避免影响主食摄入。`,
      activity: `2. 亲子互动建议

#互动游戏
玩"这是什么"的游戏，指着身体部位或日常物品，告诉宝宝它们的名称。反复几次后，可以问宝宝"眼睛在哪里"，鼓励宝宝指认。

#阅读启蒙
选择布书或硬纸板书，有大图案和鲜艳色彩的书籍更吸引宝宝。每天固定时间阅读10分钟，指着图片讲故事，培养宝宝的阅读兴趣和语言能力。

#音乐互动
播放节奏明快的儿歌，带着宝宝一起拍手、摇摆身体。音乐能促进宝宝的听觉发展和节奏感，同时增强亲子情感联结。`,
      development: `3. 智力开发建议

#认知训练
玩杯子藏物游戏，在宝宝面前将小玩具放入杯中，然后盖上另一个杯子，鼓励宝宝寻找。这有助于发展宝宝的记忆力和推理能力。

#手眼协调
准备大号积木或叠叠乐玩具，示范如何叠放，然后鼓励宝宝模仿。开始可能只能叠2-3个，随着技能提升可以尝试更多。

#语言刺激
创建"指物命名"的日常习惯，无论是吃饭、洗澡还是换衣服，都告诉宝宝正在使用的物品名称，用简短句子描述动作，如"妈妈给宝宝穿衣服"。`,
      exercise: `4. 运动建议

#坐立训练
如果宝宝已经能独立坐稳，可以玩取物游戏，将玩具放在宝宝周围不同位置，鼓励其伸手够取，锻炼平衡能力和核心肌群。

#爬行准备
帮助宝宝摆出爬行姿势（四肢支撑），可以在前方放置喜欢的玩具作为激励。轻轻支撑宝宝腹部，帮助其体验爬行动作。

#站立辅助
扶着宝宝的腋下或双手，帮助其练习站立。随着腿部力量增强，可以让宝宝扶着沙发等稳固家具练习站立。每天练习2-3次，每次5-10分钟。`
    };
  } else if (age < 24) {
    return {
      food: `1. 科学辅食推荐

#食物多样化
12-24个月宝宝可以尝试家庭饮食，但需要适当调整。主食搭配应更加多样化，如米饭、面条、馒头、土豆等，保证每餐都有谷类食物。

#蛋白质补充
每天应提供优质蛋白，如鸡蛋、鱼肉、瘦肉、豆制品等。鸡蛋可以整个食用，肉类可以切成小丁或肉末。海鱼如三文鱼含有丰富DHA，有益大脑发育。

#合理添加调味
这个阶段可以少量使用天然调味料如葱、姜、蒜提味，但应避免精制盐和糖。学习品尝食物原本的味道对培养健康饮食习惯很重要。

#中医调养建议
根据中医理论，脾胃为后天之本。建议定时定量进餐，避免过度喂养和零食过多。选择易消化食物，如小米粥、山药、莲子等健脾养胃。`,
      activity: `2. 亲子互动建议

#角色扮演
这个年龄段的宝宝开始模仿成人行为，可以玩简单的角色扮演游戏，如假装喂娃娃吃饭、打电话等。这类游戏有助于社交能力和语言发展。

#绘本共读
选择有简单故事情节的绘本，边读边提问，如"小兔子在做什么？"引导宝宝参与讲述。每天坚持阅读15-20分钟，培养专注力和想象力。

#音乐律动
播放节奏鲜明的儿歌，带领宝宝做简单的舞蹈动作，如拍手、转圈、踏步等。音乐活动能促进大脑发育，提升协调能力和音乐感知。

#亲子沟通技巧
使用"平行交谈"技巧，即描述宝宝正在做的事情，如"你在推小车，小车跑得真快"。这种方式能丰富宝宝的词汇量，建立良好的语言模式。`,
      development: `3. 智力开发建议

#形状认知
使用形状分类盒或自制卡片，教宝宝识别基本形状如圆形、方形、三角形。开始时可以选择2-3种形状，随着熟练度提高再增加难度。

#颜色辨别
在日常生活中强调颜色概念，如"这是红色的苹果"，"你穿的是蓝色的衣服"。可以玩颜色分类游戏，将相同颜色的物品归类。

#因果关系
使用简单的玩具展示因果关系，如按下按钮会发出声音、转动把手会弹出玩偶等。鼓励宝宝自己操作，理解动作与结果的联系。

#空间概念
教导基本空间概念如上下、里外、前后等。可以通过指令游戏练习，如"把积木放在盒子里"，"把球放在椅子下面"。`,
      exercise: `4. 运动建议

#行走练习
如果宝宝已经开始走路，可以设置简单的障碍路线，让宝宝绕过或跨过小障碍物，提升平衡能力和空间感知。每天练习15-20分钟，分2-3次进行。

#投掷游戏
准备软球或豆袋，教宝宝投掷到特定目标，如篮子或画在地上的圆圈。这有助于手眼协调和精细运动控制。

#攀爬活动
在安全条件下，鼓励宝宝爬上爬下小台阶或专用攀爬玩具。攀爬能锻炼全身肌肉和协调能力，培养勇气和自信心。

#平衡训练
在地上贴一条直线胶带，牵着宝宝的手沿线行走，逐渐减少辅助。这种简单的平衡训练有助于前庭系统发展和姿势控制能力。`
    };
  } else {
    return {
      food: `1. 科学辅食推荐

#膳食均衡
24-36个月的宝宝已经可以基本与家人同食，但仍需注意营养均衡。每天应包含谷类、蛋白质食物、蔬菜水果和适量奶制品。建议采用"三餐两点"的进餐模式，避免零食过多。

#食物多样性
应让宝宝尝试多种食材和烹饪方式，如蒸、煮、炖、焖等，避免单一口味导致挑食。每天至少提供3-5种蔬菜和2种水果，培养良好饮食习惯。

#合理饮食结构
一般而言，谷类占总能量的50%左右，蛋白质食物20-25%，蔬果25-30%。注意控制精制糖和盐的摄入，避免高糖饮料和加工零食。

#中医食养建议
根据中医理论，脾胃功能对儿童生长发育至关重要。建议适当添加山药、薏米、小米等健脾食材；如有食欲不振，可适量使用陈皮、山楂等开胃食材；避免过多寒凉食物，如生冷饮料和冰淇淋。`,
      activity: `2. 亲子互动建议

#故事创作
与宝宝一起看图讲故事，鼓励宝宝发挥想象力，描述图片中的场景或续编故事情节。这有助于语言表达能力和创造性思维的发展。

#生活体验
将日常家务转化为互动游戏，如一起叠衣服、整理玩具、擦桌子等。在活动中加入数数、颜色识别等认知元素，让学习融入生活。

#情感表达
通过角色扮演游戏，帮助宝宝理解和表达各种情绪。可以使用表情卡片或玩偶演示高兴、难过、生气等情绪，教导宝宝适当表达自己的感受。

#亲子阅读技巧
选择有简单故事情节的绘本，采用对话式阅读法：提问、扩展、关联生活。例如读到动物时，可以问"这是什么动物？它在做什么？"，然后扩展"你见过小狗吗？它是什么样子的？"`,
      development: `3. 智力开发建议

#分类能力
准备各种物品或图片，引导宝宝按照颜色、大小、形状或功能进行分类。开始时可以给予提示，逐渐减少帮助，培养独立思考能力。

#数量概念
在日常生活中融入数数活动，如数台阶、数玩具等。教导简单的"多少"概念，使用"多、少、一样多"等词汇描述数量关系。

#问题解决
设置简单的问题情境，如"玩具掉到沙发下面了，怎么办？"鼓励宝宝思考解决方法。这有助于培养分析问题和解决问题的能力。

#记忆力训练
玩"找不同"游戏，展示几个物品，然后移除或添加一个，让宝宝找出变化。从2-3个物品开始，随着能力提升逐渐增加难度。`,
      exercise: `4. 运动建议

#全身协调活动
设置简单的障碍跑道，包含爬行、跳跃、绕过障碍等环节。每天安排20-30分钟的活动时间，提升大运动技能和身体协调性。

#平衡能力训练
练习单脚站立，开始时可以扶着固定物体，逐渐减少支撑。踮脚走、沿直线行走等活动也有助于平衡能力发展。

#球类技能
教导基本的踢球、抛球和接球技能。使用大一点的软球开始练习，随着技能提升可以尝试小一些的球。这类活动促进手眼协调和空间感知。

#音律运动
跟着音乐做简单的舞蹈动作，如跳跃、转圈、摇摆等。音律运动不仅锻炼协调性，还能培养音乐感和表达能力。每次活动15-20分钟，注意观察宝宝疲劳信号，适时休息。`
    };
  }
}

export async function generateRecommendations(data: BabyData): Promise<RecommendationType> {
  // 在静态导出环境中，直接使用本地函数
  if (typeof window !== 'undefined') {
    // 客户端环境，模拟异步操作
    await new Promise(resolve => setTimeout(resolve, 1000));
    return generateRecommendationsByAge(data.age);
  }
  
  // 服务器端环境（开发时）
  try {
    const response = await fetch('/api/recommendations', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(data),
    });

    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }

    return await response.json();
  } catch (error) {
    // 如果API调用失败，回退到本地函数
    console.warn('API call failed, using local function:', error);
    return generateRecommendationsByAge(data.age);
  }
}